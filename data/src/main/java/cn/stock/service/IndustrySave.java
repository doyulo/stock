package cn.stock.service;

import cn.stock.dao.EastMoneyIndestryMapper;
import cn.stock.model.EastMoneyIndestry;
import cn.stock.model.EastMoneyIndestryExample;
import com.alibaba.fastjson.JSONArray;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import java.util.List;

@Service
public class IndustrySave {
    @Autowired
    private EastMoneyIndestryMapper eastMoneyIndestryMapper;
    @Autowired
    private JdbcTemplate jdbcTemplate;
    @Autowired
    private RestTemplate restTemplate;

    public void saveEastMoneyIndustry(){
        String industryStr = "[\"1,BK0477,酿酒行业,2.24,2040523017446,0.96,32|1|4|0,000596,2,古井贡酒,99.66,10.00,600238,1,*ST椰岛,6.47,-0.77,2,27437.02,601.12\",\"1,BK0730,农药兽药,1.98,221731383552,1.38,19|3|2|2,603718,1,海利生物,15.82,10.01,002215,2,诺普信,7.16,-0.83,2,772.20,14.99\",\"1,BK0438,食品饮料,1.71,1019718928219,1.17,51|10|12|5,002770,2,科迪乳业,3.25,10.17,002840,2,华统股份,19.50,-6.52,2,14169.64,238.10\",\"1,BK0465,医药制造,1.61,3543008628762,1.29,171|16|36|10,300534,2,陇神戎发,9.32,10.04,000790,2,泰合健康,7.29,-10.00,2,22330.10,354.45\",\"1,BK0422,交运物流,1.18,797841218957,0.54,27|10|17|3,603713,1,N密尔,16.23,44.01,002357,2,富临运业,7.34,-3.04,2,4967.76,58.04\",\"1,BK0546,玻璃陶瓷,1.14,236772073542,0.76,19|5|7|4,603021,1,山东华鹏,7.50,9.97,603601,1,再升科技,9.10,-0.87,2,16701.70,189.03\",\"1,BK0478,有色金属,1.13,1075550084668,0.89,51|13|16|13,000962,2,东方钽业,6.02,10.05,600614,1,鹏起科技,5.45,-2.50,2,8731.05,97.17\",\"1,BK0734,珠宝首饰,1.04,91433940525,2.18,7|4|3|1,002345,2,潮宏基,8.70,8.34,000587,2,金洲慈航,3.40,-0.87,2,549.08,5.66\",\"1,BK0727,医疗行业,1.04,657812351382,1.47,39|4|14|2,002932,2,明德生物,39.20,9.99,600896,1,*ST海投,4.86,-5.08,2,837.70,8.59\",\"1,BK0479,钢铁行业,0.91,770919812346,0.76,24|8|7|4,600507,1,方大特钢,11.40,5.46,600569,1,安阳钢铁,4.33,-2.26,2,4831.15,43.80\",\"1,BK0427,公用事业,0.91,295595954934,0.38,22|7|9|1,000593,2,大通燃气,8.09,10.07,600461,1,洪城水业,6.44,-1.38,2,5721.81,51.83\",\"1,BK0485,旅游酒店,0.75,363478864936,0.76,18|5|14|2,002707,2,众信旅游,10.09,8.85,600358,1,国旅联合,4.81,-2.04,2,11954.30,89.20\",\"1,BK0738,多元金融,0.71,333373479485,0.65,12|4|6|3,600599,1,熊猫金控,16.01,6.73,000563,2,陕国投A,3.08,-3.14,2,494.06,3.50\",\"1,BK0424,水泥建材,0.67,554571818229,0.95,27|4|14|2,002271,2,东方雨虹,17.01,8.48,002302,2,西部建设,11.79,-2.24,2,18347.80,121.51\",\"1,BK0451,房地产,0.59,2081004794062,0.49,81|25|38|12,000046,2,泛海控股,6.01,6.94,000560,2,我爱我家,5.93,-2.95,2,12880.89,76.01\",\"1,BK0733,包装材料,0.49,107209664568,0.93,8|4|11|1,002243,2,通产丽星,6.45,10.07,002787,2,华源控股,10.73,-2.45,2,470.60,2.29\",\"1,BK0458,仪器仪表,0.44,212327356838,0.93,23|3|16|2,300648,2,星云股份,30.82,9.99,300667,2,必创科技,35.69,-2.41,2,6636.45,28.84\",\"1,BK0457,输配电气,0.43,835383723856,0.88,44|22|45|8,002112,2,三变科技,9.19,10.06,600290,1,华仪电气,5.63,-10.06,2,10584.52,44.91\",\"1,BK0471,化纤行业,0.37,293520477809,0.88,11|4|9|1,601113,1,华鼎股份,7.16,2.73,300384,2,三联虹普,41.50,-1.64,2,8992.81,32.81\",\"1,BK0740,文教休闲,0.37,229845533559,0.88,13|6|14|2,002301,2,齐心集团,10.73,6.55,300703,2,创源文化,20.18,-3.44,2,530.26,1.97\",\"1,BK0910,专用设备,0.35,407696189676,1.52,31|6|42|0,603105,1,芯能科技,10.20,10.03,603666,1,亿嘉和,111.55,-5.64,2,959.23,3.34\",\"1,BK0421,高速公路,0.35,248081707894,0.24,10|5|5|0,600012,1,皖通高速,6.10,2.01,600377,1,XD宁沪高,8.86,-0.78,2,4227.80,14.70\",\"1,BK0538,化工行业,0.34,1469262730855,1.28,92|20|78|9,002909,2,集泰股份,18.90,10.01,002053,2,云南能投,9.07,-10.02,2,12140.07,41.44\",\"1,BK0454,塑胶制品,0.33,284265717916,1.15,24|5|24|4,002694,2,顾地科技,5.41,9.96,603856,1,东宏股份,15.77,-5.29,2,6869.20,22.69\",\"1,BK0429,交运设备,0.32,311889667901,0.30,10|2|10|1,300011,2,鼎汉技术,6.89,10.06,300462,2,华铭智能,23.40,-2.50,2,6608.84,21.16\",\"1,BK0537,材料行业,0.21,589885320407,1.69,30|4|36|2,603595,1,东尼电子,77.90,10.00,000511,2,烯碳退,0.71,-10.13,2,16245.17,34.21\",\"1,BK0459,电子元件,0.18,2273778758357,1.87,106|15|90|6,600152,1,维科技术,5.57,10.08,002866,2,传艺科技,17.24,-9.97,2,9978.08,18.10\",\"1,BK0456,家电行业,0.17,1226489183873,0.71,27|3|22|2,002032,2,苏泊尔,53.30,6.30,603486,1,科沃斯,69.85,-6.95,2,9660.80,16.06\",\"1,BK0428,电力行业,0.17,1318948388657,0.24,31|9|28|0,601330,1,绿色动力,27.67,10.02,000939,2,*ST凯迪,3.00,-5.06,2,8362.41,14.28\",\"1,BK0450,港口水运,0.11,544871107773,0.16,15|5|10|0,600317,1,营口港,2.24,2.28,000022,2,深赤湾A,19.00,-1.61,2,6443.71,6.94\",\"1,BK0731,化肥行业,0.11,212588771268,0.72,10|4|11|4,000422,2,*ST宜化,2.19,4.78,300575,2,中旗股份,38.54,-4.18,2,609.92,0.70\",\"1,BK0470,造纸印刷,0.11,240292382657,1.68,18|4|11|0,600793,1,宜宾纸业,15.09,9.99,000576,2,广东甘化,8.31,-9.97,2,6060.69,6.83\",\"1,BK0545,机械行业,0.10,1598167864787,0.84,105|28|121|8,002164,2,宁波东力,5.02,10.09,300097,2,智云股份,18.18,-5.66,2,14646.96,14.15\",\"1,BK0437,煤炭采选,0.09,840573567281,0.34,12|6|17|2,600408,1,*ST安泰,1.85,5.11,601088,1,中国神华,17.55,-1.46,2,4799.34,4.41\",\"1,BK0484,国际贸易,0.08,171532293761,0.85,10|3|12|2,000638,2,万方发展,5.52,3.56,000509,2,华塑控股,2.66,-6.01,2,8197.86,6.62\",\"1,BK0482,商业百货,0.08,798017151514,0.52,37|10|35|2,600605,1,汇通能源,9.16,3.39,002356,2,赫美集团,19.40,-2.27,2,12581.88,10.47\",\"1,BK0539,综合行业,0.08,133223019332,0.59,14|2|7|2,000532,2,华金资本,10.04,5.13,600212,1,江泉实业,4.52,-9.96,2,5027.80,3.98\",\"1,BK0447,电子信息,0.02,1003619438671,1.43,54|7|47|4,300226,2,上海钢联,59.73,10.00,000971,2,高升控股,4.01,-9.89,2,11947.10,2.80\",\"1,BK0474,保险,0.01,2197925783230,0.17,3|0|3|0,000627,2,天茂集团,6.71,0.90,601601,1,中国太保,33.02,-1.02,2,1183.48,0.06\",\"1,BK0735,安防设备,0.00,521959352513,1.06,6|2|14|1,002632,2,道明光学,7.90,4.36,300167,2,迪威迅,5.50,-2.14,2,796.51,-0.03\",\"1,BK0433,农牧饲渔,-0.02,642847538626,0.86,27|7|37|3,600965,1,福成股份,10.96,8.19,603970,1,中农立华,20.44,-4.66,2,8192.32,-1.38\",\"1,BK0436,纺织服装,-0.09,505308921274,0.77,37|15|34|7,002687,2,乔治白,5.70,10.04,600448,1,华纺股份,4.41,-8.32,2,9744.64,-8.99\",\"1,BK0736,电信运营,-0.11,203159821364,0.62,2|1|2|0,300383,2,光环新网,14.38,1.34,002093,2,国脉科技,8.00,-1.72,2,932.91,-0.99\",\"1,BK0726,园林工程,-0.18,149325302154,1.41,10|6|7|4,300237,2,美晨生态,7.60,4.25,600610,1,*ST毅达,2.81,-5.07,2,745.62,-1.36\",\"1,BK0739,金属制品,-0.19,335568837082,0.95,26|7|26|4,601028,1,玉龙股份,5.60,10.02,600165,1,新日恒力,7.90,-10.02,2,613.39,-1.19\",\"1,BK0481,汽车行业,-0.21,2017379084933,0.75,66|8|73|2,002662,2,京威股份,4.18,10.00,300742,2,越博动力,79.06,-6.88,2,16334.52,-34.18\",\"1,BK0425,工程建设,-0.24,1302694549366,0.25,31|6|38|3,000498,2,山东路桥,3.81,2.97,300746,2,汉嘉设计,37.21,-7.11,2,13505.76,-32.89\",\"1,BK0486,文化传媒,-0.33,849294387575,0.99,34|13|41|6,002624,2,完美世界,27.40,4.58,002143,2,印纪传媒,7.14,-9.96,2,8035.61,-26.39\",\"1,BK0420,民航机场,-0.34,595064303633,0.46,5|3|5|2,600009,1,上海机场,61.73,2.80,600897,1,XD厦门空,19.83,-2.41,2,4636.50,-15.90\",\"1,BK0476,木业家具,-0.35,278313890671,0.85,12|2|21|0,603180,1,金牌厨柜,97.25,6.79,002718,2,友邦吊顶,31.37,-6.58,2,12686.90,-44.34\",\"1,BK0475,银行,-0.36,9209611937061,0.09,4|3|19|0,600036,1,招商银行,26.23,0.73,601988,1,XD中国银,3.56,-1.39,2,2494.84,-8.96\",\"1,BK0725,装修装饰,-0.38,132948873290,0.77,10|3|14|2,002504,2,弘高创意,4.23,5.75,300374,2,恒通科技,10.87,-4.90,2,603.29,-2.30\",\"1,BK0737,软件服务,-0.52,1585602241240,1.87,58|12|91|8,002354,2,天神娱乐,9.25,8.82,002072,2,凯瑞德,8.89,-10.02,2,598.91,-3.14\",\"1,BK0473,券商信托,-0.53,1799231750947,0.48,5|1|31|0,601990,1,南京证券,12.57,3.54,601066,1,中信建投,9.87,-3.89,2,77745.73,-416.56\",\"1,BK0728,环保工程,-0.53,319309822736,3.39,19|7|20|4,300125,2,易世达,17.46,7.38,300266,2,兴源环境,5.66,-10.02,2,563.87,-2.99\",\"1,BK0464,石油行业,-0.55,2527752227811,0.09,11|5|23|3,600387,1,海越股份,9.25,2.55,002828,2,贝肯能源,16.17,-3.46,2,4182.36,-22.98\",\"1,BK0480,航天航空,-0.64,373951503832,0.92,6|0|18|0,600038,1,中直股份,40.93,2.38,600760,1,中航沈飞,37.81,-3.08,2,21036.31,-135.88\",\"1,BK0448,通讯行业,-0.69,1134979792479,3.04,25|13|58|11,000063,2,中兴通讯,14.10,5.94,600203,1,福日电子,7.09,-7.44,2,7768.41,-53.91\",\"1,BK0732,贵金属,-0.91,213032008828,0.81,1|3|9|3,600311,1,荣华实业,2.92,0.69,000506,2,中润资源,2.93,-2.66,2,611.52,-5.59\",\"1,BK0729,船舶制造,-1.14,154054990484,0.48,3|0|8|0,002552,2,*ST宝鼎,4.81,1.05,300008,2,天海防务,3.78,-7.13,2,372.00,-4.27\",\"1,BK0440,工艺商品,-1.30,9514545326,3.67,1|0|2|0,600439,1,瑞贝卡,3.31,2.16,603398,1,邦宝益智,18.07,-3.37,2,29764.74,-391.78\"]";

        JSONArray arr = JSONArray.parseArray(industryStr);

        for (Object o : arr) {
            EastMoneyIndestry eastMoneyIndestry = new EastMoneyIndestry();
            String ins = o.toString();
            String[] item = ins.split(",");
            eastMoneyIndestry.setCode(item[1]);
            eastMoneyIndestry.setName(item[2]);
            eastMoneyIndestryMapper.insert(eastMoneyIndestry);
        }

    }

    public void saveRela(){
        List<EastMoneyIndestry> eastMoneyIndestries = eastMoneyIndestryMapper.selectByExample(new EastMoneyIndestryExample());
        for (EastMoneyIndestry eastMoneyIndestry : eastMoneyIndestries) {
            saveRelaCode(eastMoneyIndestry.getCode());
        }

    }

    private void saveRelaCode(String industry){
        String url = "http://nufm.dfcfw.com/EM_Finance2014NumericApplication/JS.aspx?type=CT&token=4f1862fc3b5e77c150a2b985b12db0fd&sty=DCFFPBFMS&st=(BalFlowMain)&sr=-1&cmd=C."+industry+"1&p=1&ps=300&_=1531659844557";
        String data = restTemplate.getForObject(url, String.class);
        data = data.replace("(","");
        data = data.replace(")","");
        JSONArray arr = JSONArray.parseArray(data);
        for (Object o : arr) {
            String stock = o.toString();
            String[] item = stock.split(",");
            if(item[0].equals("1")){
                item[1] = "sh"+item[1];
            }
            jdbcTemplate.update("INSERT INTO `stock`.`code_industry_rela` (`code`, `industry`) VALUES (?, ?)",item[1],industry);
        }
    }

}
